# è®¤è¯æ¨¡å— API

## åŸºç¡€ä¿¡æ¯

- **æ¨¡å—è·¯å¾„**: `/api/v1/auth`
- **æ¥å£æ•°é‡**: 5
- **è®¤è¯æ–¹å¼**: éƒ¨åˆ†æ¥å£éœ€è¦ Bearer Token

---

## 1. ç”¨æˆ·æ³¨å†Œ

### åŸºæœ¬ä¿¡æ¯

- **æ¥å£è·¯å¾„**: `POST /api/v1/auth/register`
- **æ¥å£è¯´æ˜**: æ³¨å†Œæ–°ç”¨æˆ·å¹¶è¿”å›è®¿é—®ä»¤ç‰Œ
- **æ˜¯å¦éœ€è¦è®¤è¯**: âŒ å¦
- **ğŸ æ–°ç”¨æˆ·å¥–åŠ±**:
  - æ³¨å†Œå³é€ **50ä¸‡å­—æ•°**ï¼ˆèµ é€å­—æ•°ï¼‰
  - æ¯æ—¥å…è´¹ **1ä¸‡å­—æ•°**ï¼ˆè‡ªåŠ¨åˆ·æ–°ï¼‰

### è¯·æ±‚å‚æ•°

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | è¯´æ˜                              | ç¤ºä¾‹               |
| -------- | ------ | ---- | --------------------------------- | ------------------ |
| username | string | âœ…   | ç”¨æˆ·åï¼ˆ3-20å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿ï¼‰ | `testuser`         |
| email    | string | âœ…   | é‚®ç®±åœ°å€                          | `user@example.com` |
| password | string | âœ…   | å¯†ç ï¼ˆ8-32ä½ï¼Œéœ€åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—ï¼‰ | `Password123`      |
| confirmPassword | string | âœ…   | ç¡®è®¤å¯†ç ï¼ˆå¿…é¡»ä¸å¯†ç ä¸€è‡´ï¼‰    | `Password123`      |
| nickname | string | âŒ   | æ˜µç§°ï¼ˆæœ€å¤š 50 å­—ç¬¦ï¼Œé»˜è®¤ä½¿ç”¨ç”¨æˆ·åï¼‰ | `æµ‹è¯•ç”¨æˆ·`         |
| inviteCode | string | âŒ   | é‚€è¯·ç                           | `INVITE2024`       |

### è¯·æ±‚ç¤ºä¾‹

```http
POST /api/v1/auth/register
Content-Type: application/json

{
  "username": "testuser",
  "email": "test@example.com",
  "password": "Password123!",
  "confirmPassword": "Password123!",
  "nickname": "æµ‹è¯•ç”¨æˆ·"
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 36000,
    "user": {
      "id": 1,
      "email": "test@example.com",
      "username": "testuser",
      "nickname": "æµ‹è¯•ç”¨æˆ·",
      "avatar": null,
      "bio": null,
      "status": "active",
      "balance": 0,
      "emailVerified": false,
      "roles": [
        {
          "id": 2,
          "name": "æ™®é€šç”¨æˆ·",
          "code": "user"
        }
      ]
    }
  },
  "timestamp": 1234567890
}
```

### é”™è¯¯å“åº”

**é‚®ç®±å·²å­˜åœ¨ (409)**

```json
{
  "success": false,
  "code": 409,
  "message": "é‚®ç®±å·²è¢«æ³¨å†Œ",
  "data": {
    "error": "ConflictException",
    "path": "/api/v1/auth/register",
    "method": "POST"
  },
  "timestamp": 1234567890
}
```

---

## 2. ç”¨æˆ·ç™»å½•

### åŸºæœ¬ä¿¡æ¯

- **æ¥å£è·¯å¾„**: `POST /api/v1/auth/login`
- **æ¥å£è¯´æ˜**: ç”¨æˆ·ç™»å½•è·å–è®¿é—®ä»¤ç‰Œ
- **æ˜¯å¦éœ€è¦è®¤è¯**: âŒ å¦

### è¯·æ±‚å‚æ•°

| å‚æ•°å   | ç±»å‹   | å¿…å¡« | è¯´æ˜     |
| -------- | ------ | ---- | -------- |
| email    | string | âœ…   | é‚®ç®±åœ°å€ |
| password | string | âœ…   | å¯†ç      |

### è¯·æ±‚ç¤ºä¾‹

```http
POST /api/v1/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "Test123456"
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 36000,
    "user": {
      "id": 1,
      "email": "test@example.com",
      "username": "testuser",
      "nickname": "æµ‹è¯•ç”¨æˆ·",
      "roles": [
        {
          "id": 2,
          "name": "æ™®é€šç”¨æˆ·",
          "code": "user"
        }
      ]
    }
  },
  "timestamp": 1234567890
}
```

### é”™è¯¯å“åº”

**é‚®ç®±æˆ–å¯†ç é”™è¯¯ (401)**

```json
{
  "success": false,
  "code": 401,
  "message": "é‚®ç®±æˆ–å¯†ç é”™è¯¯",
  "data": {
    "error": "UnauthorizedException",
    "path": "/api/v1/auth/login",
    "method": "POST"
  },
  "timestamp": 1234567890
}
```

**è´¦å·å·²è¢«å°ç¦ (403)**

```json
{
  "success": false,
  "code": 403,
  "message": "è´¦å·å·²è¢«å°ç¦",
  "data": {
    "error": "ForbiddenException",
    "path": "/api/v1/auth/login",
    "method": "POST"
  },
  "timestamp": 1234567890
}
```

---

## 3. åˆ·æ–°ä»¤ç‰Œ

### åŸºæœ¬ä¿¡æ¯

- **æ¥å£è·¯å¾„**: `POST /api/v1/auth/refresh`
- **æ¥å£è¯´æ˜**: ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œ
- **æ˜¯å¦éœ€è¦è®¤è¯**: âŒ å¦

### è¯·æ±‚å‚æ•°

| å‚æ•°å       | ç±»å‹   | å¿…å¡« | è¯´æ˜     |
| ------------ | ------ | ---- | -------- |
| refreshToken | string | âœ…   | åˆ·æ–°ä»¤ç‰Œ |

### è¯·æ±‚ç¤ºä¾‹

```http
POST /api/v1/auth/refresh
Content-Type: application/json

{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "expiresIn": 36000
  },
  "timestamp": 1234567890
}
```

### é”™è¯¯å“åº”

**ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ (401)**

```json
{
  "success": false,
  "code": 401,
  "message": "åˆ·æ–°ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "data": {
    "error": "UnauthorizedException",
    "path": "/api/v1/auth/refresh",
    "method": "POST"
  },
  "timestamp": 1234567890
}
```

---

## 4. é‡ç½®å¯†ç 

### åŸºæœ¬ä¿¡æ¯

- **æ¥å£è·¯å¾„**: `POST /api/v1/auth/reset-password`
- **æ¥å£è¯´æ˜**: é€šè¿‡é‚®ç®±éªŒè¯ç é‡ç½®å¯†ç 
- **æ˜¯å¦éœ€è¦è®¤è¯**: âŒ å¦

### è¯·æ±‚å‚æ•°

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|------|------|
| email | string | âœ… | é‚®ç®±åœ°å€ | `user@example.com` |
| verificationCode | string | âœ… | 6ä½éªŒè¯ç  | `123456` |
| newPassword | string | âœ… | æ–°å¯†ç ï¼ˆ8-32ä½ï¼Œå¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—ï¼‰ | `NewPassword123` |

### è¯·æ±‚ç¤ºä¾‹

```http
POST /api/v1/auth/reset-password
Content-Type: application/json

{
  "email": "user@example.com",
  "verificationCode": "123456",
  "newPassword": "NewPassword123"
}
```

### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº”** (200)
```json
{
  "success": true,
  "code": 200,
  "message": "å¯†ç é‡ç½®æˆåŠŸï¼Œè¯·ä½¿ç”¨æ–°å¯†ç ç™»å½•",
  "data": {
    "message": "å¯†ç é‡ç½®æˆåŠŸï¼Œè¯·ä½¿ç”¨æ–°å¯†ç ç™»å½•"
  },
  "timestamp": 1234567890
}
```

### é”™è¯¯å“åº”

**éªŒè¯ç æ— æ•ˆ** (400)
```json
{
  "success": false,
  "code": 400,
  "message": "éªŒè¯ç æ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "data": {
    "error": "BadRequestException",
    "path": "/api/v1/auth/reset-password",
    "method": "POST"
  },
  "timestamp": 1234567890
}
```

**é‚®ç®±æœªæ³¨å†Œ** (400)
```json
{
  "success": false,
  "code": 400,
  "message": "è¯¥é‚®ç®±æœªæ³¨å†Œ",
  "data": {
    "error": "BadRequestException",
    "path": "/api/v1/auth/reset-password",
    "method": "POST"
  },
  "timestamp": 1234567890
}
```

---

## 5. ç”¨æˆ·ç™»å‡º

### åŸºæœ¬ä¿¡æ¯

- **æ¥å£è·¯å¾„**: `POST /api/v1/auth/logout`
- **æ¥å£è¯´æ˜**: ç”¨æˆ·ç™»å‡ºï¼Œæ¸…é™¤åˆ·æ–°ä»¤ç‰Œ
- **æ˜¯å¦éœ€è¦è®¤è¯**: âœ… æ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {accessToken}
```

### è¯·æ±‚ç¤ºä¾‹

```http
POST /api/v1/auth/logout
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "message": "ç™»å‡ºæˆåŠŸ"
  },
  "timestamp": 1234567890
}
```

---

## 6. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

### åŸºæœ¬ä¿¡æ¯

- **æ¥å£è·¯å¾„**: `GET /api/v1/auth/profile`
- **æ¥å£è¯´æ˜**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯
- **æ˜¯å¦éœ€è¦è®¤è¯**: âœ… æ˜¯

### è¯·æ±‚å¤´

```
Authorization: Bearer {accessToken}
```

### è¯·æ±‚ç¤ºä¾‹

```http
GET /api/v1/auth/profile
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

### å“åº”ç¤ºä¾‹

```json
{
  "success": true,
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": 1,
    "email": "test@example.com",
    "username": "testuser",
    "nickname": "æµ‹è¯•ç”¨æˆ·",
    "avatar": "https://example.com/avatar.jpg",
    "bio": "è¿™æ˜¯æˆ‘çš„ä¸ªäººç®€ä»‹",
    "status": "active",
    "balance": 10000,
    "emailVerified": true,
    "lastLoginAt": "2024-01-01T12:00:00.000Z",
    "createdAt": "2024-01-01T10:00:00.000Z",
    "updatedAt": "2024-01-01T12:00:00.000Z",
    "roles": [
      {
        "id": 1,
        "name": "è¶…çº§ç®¡ç†å‘˜",
        "code": "super_admin",
        "description": "æ‹¥æœ‰æ‰€æœ‰æƒé™",
        "permissions": [
          {
            "id": 1,
            "name": "ç”¨æˆ·ç®¡ç†",
            "code": "user",
            "type": "menu"
          }
        ]
      }
    ]
  },
  "timestamp": 1234567890
}
```

---

## æ³¨æ„äº‹é¡¹

1. **å¯†ç å®‰å…¨**

   - å¯†ç éœ€è¦ 6-50 ä½
   - å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—
   - å¯†ç ä¼šä½¿ç”¨ bcrypt åŠ å¯†å­˜å‚¨

2. **ä»¤ç‰Œæœ‰æ•ˆæœŸ**

   - accessToken: 10 å°æ—¶ï¼ˆ36000 ç§’ï¼‰
   - refreshToken: 7 å¤©

3. **è´¦å·çŠ¶æ€**

   - `active`: æ­£å¸¸
   - `inactive`: æœªæ¿€æ´»
   - `banned`: å·²å°ç¦ï¼ˆæ— æ³•ç™»å½•ï¼‰

4. **é»˜è®¤è§’è‰²**

   - æ³¨å†Œæ—¶ä¼šè‡ªåŠ¨åˆ†é…"æ™®é€šç”¨æˆ·"è§’è‰²
   - é¦–ä¸ªæ³¨å†Œç”¨æˆ·å»ºè®®æ‰‹åŠ¨å‡çº§ä¸ºè¶…çº§ç®¡ç†å‘˜

5. **é”™è¯¯å¤„ç†**
   - 401: æœªè®¤è¯æˆ–ä»¤ç‰Œæ— æ•ˆ
   - 403: è´¦å·å·²è¢«å°ç¦
   - 409: é‚®ç®±æˆ–ç”¨æˆ·åå·²å­˜åœ¨
   - 400: å‚æ•°éªŒè¯å¤±è´¥
