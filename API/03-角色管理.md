# 角色管理模块 API

## 基础信息

- **模块路径**: `/api/v1/roles`
- **接口数量**: 7
- **认证方式**: 所有接口都需要 Bearer Token

---

## 目录

1. [获取角色列表](#1-获取角色列表)
2. [获取角色详情](#2-获取角色详情)
3. [创建角色](#3-创建角色)
4. [更新角色](#4-更新角色)
5. [删除角色](#5-删除角色)
6. [为角色分配权限](#6-为角色分配权限)
7. [获取角色的权限列表](#7-获取角色的权限列表)

---

## 1. 获取角色列表

### 基本信息

- **接口路径**: `GET /api/v1/roles`
- **接口说明**: 获取所有角色列表（含权限信息）
- **所需权限**: `permission:role:list`

### 请求示例

```http
GET /api/v1/roles
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "name": "超级管理员",
      "code": "super_admin",
      "description": "拥有所有权限",
      "level": 100,
      "isSystem": true,
      "status": "active",
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T10:00:00.000Z",
      "permissions": [
        {
          "id": 1,
          "name": "用户管理",
          "code": "user",
          "type": "menu"
        },
        {
          "id": 2,
          "name": "查看用户列表",
          "code": "user:list",
          "type": "api"
        }
      ]
    },
    {
      "id": 2,
      "name": "普通用户",
      "code": "user",
      "description": "普通用户权限",
      "level": 10,
      "isSystem": true,
      "status": "active",
      "createdAt": "2024-01-01T10:00:00.000Z",
      "updatedAt": "2024-01-01T10:00:00.000Z",
      "permissions": [
        {
          "id": 2,
          "name": "查看用户列表",
          "code": "user:list",
          "type": "api"
        }
      ]
    }
  ],
  "timestamp": 1234567890
}
```

---

## 2. 获取角色详情

### 基本信息

- **接口路径**: `GET /api/v1/roles/:id`
- **接口说明**: 获取指定角色的详细信息（含权限和用户信息）
- **所需权限**: `permission:role:list`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 角色 ID |

### 请求示例

```http
GET /api/v1/roles/1
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "name": "超级管理员",
    "code": "super_admin",
    "description": "拥有所有权限",
    "level": 100,
    "isSystem": true,
    "status": "active",
    "createdAt": "2024-01-01T10:00:00.000Z",
    "updatedAt": "2024-01-01T10:00:00.000Z",
    "permissions": [
      {
        "id": 1,
        "name": "用户管理",
        "code": "user",
        "type": "menu",
        "description": "用户管理模块"
      }
    ],
    "users": [
      {
        "id": 1,
        "username": "admin",
        "email": "admin@example.com"
      }
    ]
  },
  "timestamp": 1234567890
}
```

---

## 3. 创建角色

### 基本信息

- **接口路径**: `POST /api/v1/roles`
- **接口说明**: 创建新角色
- **所需权限**: `permission:role:create`

### 请求参数

| 参数名      | 类型   | 必填 | 说明                           |
| ----------- | ------ | ---- | ------------------------------ |
| name        | string | ✅   | 角色名称（最多 50 字符）       |
| code        | string | ✅   | 角色代码（最多 50 字符，唯一） |
| description | string | ❌   | 角色描述（最多 200 字符）      |
| level       | number | ❌   | 角色等级（1-100，默认 10）     |

### 请求示例

```http
POST /api/v1/roles
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "name": "编辑",
  "code": "editor",
  "description": "内容编辑人员",
  "level": 50
}
```

### 响应示例

```json
{
  "success": true,
  "code": 201,
  "message": "操作成功",
  "data": {
    "id": 3,
    "name": "编辑",
    "code": "editor",
    "description": "内容编辑人员",
    "level": 50,
    "isSystem": false,
    "status": "active",
    "createdAt": "2024-01-01T12:00:00.000Z",
    "updatedAt": "2024-01-01T12:00:00.000Z"
  },
  "timestamp": 1234567890
}
```

### 错误响应

**角色代码已存在 (409)**

```json
{
  "success": false,
  "code": 409,
  "message": "角色代码已存在",
  "data": {
    "error": "ConflictException",
    "path": "/api/v1/roles",
    "method": "POST"
  },
  "timestamp": 1234567890
}
```

---

## 4. 更新角色

### 基本信息

- **接口路径**: `PATCH /api/v1/roles/:id`
- **接口说明**: 更新角色信息（系统角色的代码不可修改）
- **所需权限**: `permission:role:update`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 角色 ID |

### 请求参数

| 参数名      | 类型   | 必填 | 说明                         |
| ----------- | ------ | ---- | ---------------------------- |
| name        | string | ❌   | 角色名称                     |
| code        | string | ❌   | 角色代码（系统角色不可修改） |
| description | string | ❌   | 角色描述                     |
| level       | number | ❌   | 角色等级                     |

### 请求示例

```http
PATCH /api/v1/roles/3
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "name": "高级编辑",
  "description": "高级内容编辑人员",
  "level": 60
}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 3,
    "name": "高级编辑",
    "code": "editor",
    "description": "高级内容编辑人员",
    "level": 60,
    "isSystem": false,
    "status": "active",
    "createdAt": "2024-01-01T12:00:00.000Z",
    "updatedAt": "2024-01-01T13:00:00.000Z"
  },
  "timestamp": 1234567890
}
```

---

## 5. 删除角色

### 基本信息

- **接口路径**: `DELETE /api/v1/roles/:id`
- **接口说明**: 删除角色（系统角色不可删除，有用户的角色不可删除）
- **所需权限**: `permission:role:delete`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 角色 ID |

### 请求示例

```http
DELETE /api/v1/roles/3
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": null,
  "timestamp": 1234567890
}
```

### 错误响应

**系统角色不可删除 (400)**

```json
{
  "success": false,
  "code": 400,
  "message": "不允许删除系统角色",
  "data": {
    "error": "BadRequestException"
  },
  "timestamp": 1234567890
}
```

**角色下还有用户 (400)**

```json
{
  "success": false,
  "code": 400,
  "message": "该角色下还有用户，无法删除",
  "data": {
    "error": "BadRequestException"
  },
  "timestamp": 1234567890
}
```

---

## 6. 为角色分配权限

### 基本信息

- **接口路径**: `PUT /api/v1/roles/:id/permissions`
- **接口说明**: 为角色分配权限（会替换原有权限）
- **所需权限**: `permission:role:assign`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 角色 ID |

### 请求参数

| 参数名        | 类型     | 必填 | 说明         |
| ------------- | -------- | ---- | ------------ |
| permissionIds | number[] | ✅   | 权限 ID 数组 |

### 请求示例

```http
PUT /api/v1/roles/3/permissions
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "permissionIds": [1, 2, 3, 4, 5]
}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 3,
    "name": "编辑",
    "code": "editor",
    "permissions": [
      {
        "id": 1,
        "name": "用户管理",
        "code": "user",
        "type": "menu"
      },
      {
        "id": 2,
        "name": "查看用户列表",
        "code": "user:list",
        "type": "api"
      },
      {
        "id": 3,
        "name": "查看用户详情",
        "code": "user:view",
        "type": "api"
      }
    ]
  },
  "timestamp": 1234567890
}
```

---

## 7. 获取角色的权限列表

### 基本信息

- **接口路径**: `GET /api/v1/roles/:id/permissions`
- **接口说明**: 获取角色的所有权限
- **所需权限**: `permission:role:list`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 角色 ID |

### 请求示例

```http
GET /api/v1/roles/1/permissions
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": [
    {
      "id": 1,
      "parentId": null,
      "name": "用户管理",
      "code": "user",
      "type": "menu",
      "resource": null,
      "method": null,
      "description": "用户管理模块",
      "sortOrder": 0,
      "status": "active"
    },
    {
      "id": 2,
      "parentId": 1,
      "name": "查看用户列表",
      "code": "user:list",
      "type": "api",
      "resource": "/api/v1/users",
      "method": "GET",
      "description": "查看用户列表",
      "sortOrder": 0,
      "status": "active"
    }
  ],
  "timestamp": 1234567890
}
```

---

## 注意事项

1. **系统角色**

   - `super_admin` 和 `user` 是系统角色
   - 系统角色不可删除
   - 系统角色的代码不可修改

2. **角色等级**

   - 等级范围：1-100
   - 等级越高权限越大
   - 超级管理员建议设为 100

3. **角色代码规范**

   - 使用小写字母和下划线
   - 建议：`admin`、`editor`、`viewer`
   - 必须唯一

4. **权限分配**

   - 使用 PUT 方法会替换原有权限
   - 传入的权限 ID 必须存在
   - 建议一次性分配完整权限

5. **删除限制**
   - 系统角色不可删除
   - 有用户使用的角色不可删除
   - 删除前需要移除所有用户
