# 用户管理模块 API

## 基础信息

- **模块路径**: `/api/v1/users`
- **接口数量**: 14
- **认证方式**: 所有接口都需要 Bearer Token

---

## 目录

1. [获取用户列表（分页）](#1-获取用户列表分页)
2. [获取当前用户信息](#2-获取当前用户信息)
3. [更新个人资料](#3-更新个人资料)
4. [修改密码](#4-修改密码)
5. [获取用户详情](#5-获取用户详情)
6. [创建用户（管理员）](#6-创建用户管理员)
7. [更新用户信息（管理员）](#7-更新用户信息管理员)
8. [删除用户](#8-删除用户)
9. [封禁用户](#9-封禁用户)
10. [解封用户](#10-解封用户)
11. [为用户分配角色](#11-为用户分配角色)
12. [获取用户权限列表](#12-获取用户权限列表)

---

## 1. 获取用户列表（分页）

### 基本信息

- **接口路径**: `GET /api/v1/users`
- **接口说明**: 分页查询用户列表，支持搜索和筛选
- **所需权限**: `user:list`

### 查询参数

| 参数名   | 类型   | 必填 | 默认值 | 说明                                     |
| -------- | ------ | ---- | ------ | ---------------------------------------- |
| page     | number | ❌   | 1      | 页码（最小 1）                           |
| pageSize | number | ❌   | 10     | 每页数量（最小 1）                       |
| search   | string | ❌   | -      | 搜索关键词（用户名、邮箱、昵称）         |
| status   | string | ❌   | -      | 用户状态：`active`、`inactive`、`banned` |
| roleCode | string | ❌   | -      | 角色代码，如：`super_admin`、`user`      |

### 请求示例

```http
GET /api/v1/users?page=1&pageSize=10&search=test&status=active
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "data": [
      {
        "id": 1,
        "email": "test@example.com",
        "username": "testuser",
        "nickname": "测试用户",
        "avatar": "https://example.com/avatar.jpg",
        "bio": "个人简介",
        "status": "active",
        "balance": 10000,
        "emailVerified": true,
        "lastLoginAt": "2024-01-01T12:00:00.000Z",
        "createdAt": "2024-01-01T10:00:00.000Z",
        "updatedAt": "2024-01-01T12:00:00.000Z",
        "roles": [
          {
            "id": 1,
            "name": "超级管理员",
            "code": "super_admin"
          }
        ]
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 10,
    "totalPages": 10
  },
  "timestamp": 1234567890
}
```

---

## 2. 获取当前用户信息

### 基本信息

- **接口路径**: `GET /api/v1/users/me`
- **接口说明**: 获取当前登录用户的信息
- **所需权限**: 无（已登录即可）

### 请求示例

```http
GET /api/v1/users/me
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "email": "test@example.com",
    "username": "testuser",
    "nickname": "测试用户",
    "avatar": "https://example.com/avatar.jpg",
    "bio": "这是我的个人简介",
    "status": "active",
    "balance": 10000,
    "emailVerified": true,
    "lastLoginAt": "2024-01-01T12:00:00.000Z",
    "createdAt": "2024-01-01T10:00:00.000Z",
    "updatedAt": "2024-01-01T12:00:00.000Z",
    "roles": [
      {
        "id": 1,
        "name": "超级管理员",
        "code": "super_admin",
        "description": "拥有所有权限",
        "permissions": [
          {
            "id": 1,
            "name": "用户管理",
            "code": "user",
            "type": "menu"
          }
        ]
      }
    ]
  },
  "timestamp": 1234567890
}
```

---

## 3. 更新个人资料

### 基本信息

- **接口路径**: `PATCH /api/v1/users/me`
- **接口说明**: 更新当前用户的个人资料
- **所需权限**: 无（已登录即可）

### 请求参数

| 参数名   | 类型   | 必填 | 说明                      |
| -------- | ------ | ---- | ------------------------- |
| username | string | ❌   | 用户名（最多 50 字符）    |
| nickname | string | ❌   | 昵称（最多 100 字符）     |
| avatar   | string | ❌   | 头像 URL（最多 500 字符） |
| bio      | string | ❌   | 个人简介（最多 500 字符） |

### 请求示例

```http
PATCH /api/v1/users/me
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "nickname": "新昵称",
  "bio": "更新后的个人简介",
  "avatar": "https://example.com/new-avatar.jpg"
}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "email": "test@example.com",
    "username": "testuser",
    "nickname": "新昵称",
    "avatar": "https://example.com/new-avatar.jpg",
    "bio": "更新后的个人简介",
    "status": "active",
    "balance": 10000
  },
  "timestamp": 1234567890
}
```

---

## 4. 修改密码

### 基本信息

- **接口路径**: `POST /api/v1/users/change-password`
- **接口说明**: 修改当前用户的密码
- **所需权限**: 无（已登录即可）

### 请求参数

| 参数名      | 类型   | 必填 | 说明                                |
| ----------- | ------ | ---- | ----------------------------------- |
| oldPassword | string | ✅   | 当前密码                            |
| newPassword | string | ✅   | 新密码（6-50 位，需包含字母和数字） |

### 请求示例

```http
POST /api/v1/users/change-password
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "oldPassword": "OldPassword123",
  "newPassword": "NewPassword456"
}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": null,
  "timestamp": 1234567890
}
```

### 错误响应

**当前密码错误 (400)**

```json
{
  "success": false,
  "code": 400,
  "message": "当前密码错误",
  "data": {
    "error": "BadRequestException",
    "path": "/api/v1/users/change-password",
    "method": "POST"
  },
  "timestamp": 1234567890
}
```

---

## 5. 获取用户详情

### 基本信息

- **接口路径**: `GET /api/v1/users/:id`
- **接口说明**: 获取指定用户的详细信息
- **所需权限**: `user:view`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 用户 ID |

### 请求示例

```http
GET /api/v1/users/1
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 1,
    "email": "test@example.com",
    "username": "testuser",
    "nickname": "测试用户",
    "avatar": "https://example.com/avatar.jpg",
    "bio": "个人简介",
    "status": "active",
    "balance": 10000,
    "emailVerified": true,
    "lastLoginAt": "2024-01-01T12:00:00.000Z",
    "createdAt": "2024-01-01T10:00:00.000Z",
    "updatedAt": "2024-01-01T12:00:00.000Z",
    "roles": [
      {
        "id": 1,
        "name": "超级管理员",
        "code": "super_admin",
        "description": "拥有所有权限",
        "permissions": [
          {
            "id": 1,
            "name": "用户管理",
            "code": "user",
            "type": "menu"
          }
        ]
      }
    ]
  },
  "timestamp": 1234567890
}
```

---

## 6. 创建用户（管理员）

### 基本信息

- **接口路径**: `POST /api/v1/users`
- **接口说明**: 管理员创建新用户
- **所需权限**: `user:create`

### 请求参数

| 参数名   | 类型   | 必填 | 说明            |
| -------- | ------ | ---- | --------------- |
| email    | string | ✅   | 邮箱地址        |
| password | string | ✅   | 密码（6-50 位） |
| username | string | ❌   | 用户名          |
| nickname | string | ❌   | 昵称            |

### 请求示例

```http
POST /api/v1/users
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "email": "newuser@example.com",
  "password": "Password123",
  "username": "newuser",
  "nickname": "新用户"
}
```

### 响应示例

```json
{
  "success": true,
  "code": 201,
  "message": "操作成功",
  "data": {
    "id": 2,
    "email": "newuser@example.com",
    "username": "newuser",
    "nickname": "新用户",
    "status": "active",
    "balance": 0,
    "roles": [
      {
        "id": 2,
        "name": "普通用户",
        "code": "user"
      }
    ]
  },
  "timestamp": 1234567890
}
```

---

## 7. 更新用户信息（管理员）

### 基本信息

- **接口路径**: `PATCH /api/v1/users/:id`
- **接口说明**: 管理员更新用户信息
- **所需权限**: `user:update`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 用户 ID |

### 请求参数

| 参数名   | 类型   | 必填 | 说明                                 |
| -------- | ------ | ---- | ------------------------------------ |
| username | string | ❌   | 用户名                               |
| nickname | string | ❌   | 昵称                                 |
| email    | string | ❌   | 邮箱                                 |
| password | string | ❌   | 密码                                 |
| status   | string | ❌   | 状态：`active`、`inactive`、`banned` |

### 请求示例

```http
PATCH /api/v1/users/2
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "nickname": "更新的昵称",
  "status": "active"
}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 2,
    "email": "user@example.com",
    "username": "user",
    "nickname": "更新的昵称",
    "status": "active"
  },
  "timestamp": 1234567890
}
```

---

## 8. 删除用户

### 基本信息

- **接口路径**: `DELETE /api/v1/users/:id`
- **接口说明**: 软删除用户（不允许删除超级管理员）
- **所需权限**: `user:delete`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 用户 ID |

### 请求示例

```http
DELETE /api/v1/users/2
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": null,
  "timestamp": 1234567890
}
```

### 错误响应

**不允许删除超级管理员 (400)**

```json
{
  "success": false,
  "code": 400,
  "message": "不允许删除超级管理员",
  "data": {
    "error": "BadRequestException"
  },
  "timestamp": 1234567890
}
```

---

## 9. 封禁用户

### 基本信息

- **接口路径**: `POST /api/v1/users/:id/ban`
- **接口说明**: 封禁用户（不允许封禁超级管理员）
- **所需权限**: `user:ban`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 用户 ID |

### 请求参数

| 参数名 | 类型   | 必填 | 说明                      |
| ------ | ------ | ---- | ------------------------- |
| reason | string | ❌   | 封禁原因（最多 500 字符） |

### 请求示例

```http
POST /api/v1/users/2/ban
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "reason": "违规操作"
}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 2,
    "email": "user@example.com",
    "username": "user",
    "status": "banned"
  },
  "timestamp": 1234567890
}
```

---

## 10. 解封用户

### 基本信息

- **接口路径**: `POST /api/v1/users/:id/unban`
- **接口说明**: 解封被封禁的用户
- **所需权限**: `user:ban`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 用户 ID |

### 请求示例

```http
POST /api/v1/users/2/unban
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 2,
    "email": "user@example.com",
    "username": "user",
    "status": "active"
  },
  "timestamp": 1234567890
}
```

---

## 11. 为用户分配角色

### 基本信息

- **接口路径**: `POST /api/v1/users/:id/roles`
- **接口说明**: 为用户分配一个或多个角色
- **所需权限**: `user:assign_roles`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 用户 ID |

### 请求参数

| 参数名  | 类型     | 必填 | 说明         |
| ------- | -------- | ---- | ------------ |
| roleIds | number[] | ✅   | 角色 ID 数组 |

### 请求示例

```http
POST /api/v1/users/2/roles
Authorization: Bearer {accessToken}
Content-Type: application/json

{
  "roleIds": [1, 2]
}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    "id": 2,
    "email": "user@example.com",
    "username": "user",
    "roles": [
      {
        "id": 1,
        "name": "超级管理员",
        "code": "super_admin"
      },
      {
        "id": 2,
        "name": "普通用户",
        "code": "user"
      }
    ]
  },
  "timestamp": 1234567890
}
```

---

## 12. 获取用户权限列表

### 基本信息

- **接口路径**: `GET /api/v1/users/:id/permissions`
- **接口说明**: 获取用户所有权限代码列表
- **所需权限**: `user:view`

### 路径参数

| 参数名 | 类型   | 必填 | 说明    |
| ------ | ------ | ---- | ------- |
| id     | number | ✅   | 用户 ID |

### 请求示例

```http
GET /api/v1/users/1/permissions
Authorization: Bearer {accessToken}
```

### 响应示例

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": [
    "user",
    "user:list",
    "user:view",
    "user:create",
    "user:update",
    "user:delete",
    "user:ban",
    "permission:role:list",
    "permission:role:create"
  ],
  "timestamp": 1234567890
}
```

---

## 注意事项

1. **权限控制**

   - 普通用户只能修改自己的资料和密码
   - 管理员可以管理所有用户
   - 超级管理员无法被删除或封禁

2. **数据验证**

   - 用户名不能重复
   - 邮箱不能重复
   - 密码必须符合安全要求

3. **用户状态**

   - `active`: 正常使用
   - `inactive`: 未激活
   - `banned`: 已封禁（无法登录）

4. **软删除**

   - 删除用户不会真正删除数据
   - 数据会标记 `deleted_at` 时间戳

5. **分页查询**
   - 默认每页 10 条
   - 最大每页 100 条
   - 总页数自动计算
