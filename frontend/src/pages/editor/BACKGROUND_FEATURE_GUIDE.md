# 编辑器背景设置功能说明

## ✨ 功能概述

编辑器支持自定义背景颜色和背景图片，让您的写作环境更加个性化和舒适。

### 核心特性

- ✅ 6 种预设护眼背景颜色（护眼黄、淡绿色、淡蓝色等）
- ✅ 支持上传自定义背景图片
- ✅ 背景图优先于背景颜色
- ✅ 背景应用到整个编辑器界面（包括顶部、章节列表、AI 助手、编辑器内容）
- ✅ 手机端和 PC 端同步
- ✅ 跨设备一致（背景保存在服务器）

---

## 🎨 使用方法

### 1. 设置背景颜色

1. 打开编辑器设置（右上角 ⚙️ 或 移动端"更多"→"编辑器设置"）
2. 滚动到"背景设置"部分
3. 在"背景颜色"中选择一个预设颜色
4. 点击"保存设置"

**预设颜色**：

- 默认白色 `#FFFFFF`
- 护眼黄 `#F5F3E8` ⭐ 推荐
- 淡绿色 `#E8F5E8`
- 淡蓝色 `#E8F0F5`
- 羊皮纸 `#FFF8DC`
- 浅灰色 `#F5F5F5`

### 2. 设置背景图片

1. 打开编辑器设置
2. 滚动到"背景设置"部分
3. 在"背景图片"中点击"选择文件"
4. 选择一张图片（JPG/PNG/WebP，最大 5MB）
5. 点击"上传背景图"
6. 点击"保存设置"

**注意**：

- 背景图会覆盖背景颜色
- 图片会自动适应屏幕大小
- 删除背景图后会恢复使用背景颜色

---

## 🖼️ 背景应用范围

设置背景后，以下区域都会应用相同的背景：

1. ✅ **页面整体背景**：整个编辑器页面
2. ✅ **顶部导航栏**：使用半透明白色叠加层
3. ✅ **章节列表**：毛玻璃效果叠加
4. ✅ **AI 助手面板**：半透明叠加
5. ✅ **编辑器内容区**：直接应用背景

---

## 📱 跨设备同步

背景设置保存在服务器上，因此：

- ✅ 在电脑上设置的背景，手机上也能看到
- ✅ 在手机上设置的背景，电脑上也能看到
- ✅ 背景图片存储在服务器，所有设备都能正常显示

---

## 🔧 技术实现

### 后端

**数据库字段**：

- `background_color` - 背景颜色（CSS 颜色值）
- `background_image` - 背景图片路径

**API 接口**：

- `POST /api/v1/editor-settings/upload-background` - 上传背景图
- `DELETE /api/v1/editor-settings/background` - 删除背景图
- `PUT /api/v1/editor-settings` - 更新背景颜色

**限制规则**：

- 图片格式：JPG, PNG, WebP
- 文件大小：最大 5MB
- 每个用户只能有 1 张背景图（上传新图会自动删除旧图）

### 前端

**背景应用逻辑**：

1. 优先级：背景图 > 背景颜色 > 默认渐变
2. 页面级别：`NovelEditor.tsx` 应用到根容器
3. 编辑器级别：`TipTapEditor.tsx` 应用到编辑器内容

---

## 💡 使用建议

### 护眼配色推荐

**长时间写作**：

- 护眼黄 `#F5F3E8` + 深色文字
- 淡绿色 `#E8F5E8` + 深色文字

**夜间写作**：

- 使用"深色主题" + 深灰背景

**个性化**：

- 上传您喜欢的风景图、纹理图作为背景
- 建议使用低饱和度、浅色调的图片，避免影响文字阅读

### 背景图选择技巧

- ✅ 使用低对比度的图片（避免干扰阅读）
- ✅ 浅色调、低饱和度
- ✅ 简洁的纹理或渐变
- ❌ 避免复杂的图案
- ❌ 避免深色或高对比度图片

---

## 🚀 更新日志

**2025-11-02**：

- ✨ 新增背景颜色选择功能
- ✨ 新增背景图片上传功能
- ✨ 背景自动应用到所有组件
- ✨ 支持跨设备同步

---

## 🔗 相关功能

- [编辑器设置](./EDITOR_SETTINGS_INTEGRATION.md)
- [字体上传](../../../docs/字体系统实现说明.md)
- [主题切换](./EDITOR_SETTINGS_INTEGRATION.md#主题设置)
